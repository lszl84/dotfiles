#+TITLE: dwm Configuration
#+DESCRIPTION: dwm setup for LMDE 7 with HiDPI, alongside Cinnamon

* Overview

A minimal dwm 6.5 tiling window manager setup that coexists with Cinnamon
via LightDM session selection. Compiled from source with a custom =config.h=
and installed to =~/.local/=.

* Key Bindings

| Key                 | Action                       |
|---------------------+------------------------------|
| Super+Return        | Open terminal (st)           |
| Super+BackSpace     | Kill focused window          |
| Super+Space         | Launch rofi                  |
| Super+j/k           | Focus next/prev window       |
| Super+h             | Shrink master area           |
| Super+,/.           | Shrink/grow master area      |
| Super+l             | Lock screen                  |
| Super+i/d           | Add/remove master slot       |
| Super+Shift+Return  | Swap focused to master       |
| Super+Left/Right    | Previous/next tag            |
| Ctrl+Alt+Left/Right | Previous/next tag (touchegg) |
| Alt+Tab/Shift+Tab   | Cycle window focus           |
| Super+1-4           | Jump to tag                  |
| Super+Shift+1-4     | Move window to tag           |
| Super+t/f/m         | Tiled/floating/monocle       |
| Super+Shift+Space   | Toggle floating              |
| Super+Tab           | Toggle last tag              |
| Super+b             | Toggle bar                   |
| Super+0             | View all tags                |
| Super+Shift+0       | Tag window on all tags       |
| Super+Shift+BackSpace | Quit dwm                   |
| XF86AudioRaiseVol   | Volume up 5%                 |
| XF86AudioLowerVol   | Volume down 5%               |
| XF86AudioMute       | Toggle mute                  |
| XF86BrightnessUp    | Brightness up 10%            |
| XF86BrightnessDown  | Brightness down 10%          |

* Status Bar

Format: =[N updates | ]vol XX% | bat XX% (Xh Xm left) | up Xd | HH:MM=

- *APT updates*: count of pending upgrades (hidden if 0)
- *Volume*: percentage or "mute" (via wpctl or amixer)
- *Battery*: capacity percentage + time remaining, with status2d color coding
- *Uptime*: days since boot
- *Time*: 24-hour format

Refreshes every 5 seconds via =dwm-status=. Instant volume updates via
=pkill -USR1 dwm-status= triggered by the volume key bindings.

* HiDPI Configuration

The display is 3120x2080 and uses 2x scaling:

- =Xft.dpi: 192= via =xresources= (loaded by =xrdb=)
- =xsettingsd= provides =Gdk/WindowScalingFactor 2= and =Gdk/UnscaledDPI 196608= for GTK apps
- =QT_AUTO_SCREEN_SCALE_FACTOR=1= for Qt apps
- =gsettings= sets =color-scheme= and =gtk-theme= for libadwaita/GTK 3 dark theme
- dwm font set to =monospace:size=10=, border to 2px, gaps to 14px (7 logical)
- st font set to =Liberation Mono:pixelsize=28=
- rofi font set to =monospace 20=
- Cursor size: 48px (=XCURSOR_SIZE= and =Xcursor.size=)

* Touchpad / Input Devices

Configured via Xorg at =/etc/X11/xorg.conf.d/40-touchpad.conf=:

- *Natural scrolling*: enabled
- *Tap-to-click*: enabled
- *Click method*: clickfinger (no button areas)

Settings are applied by libinput automatically, including after resume.

* Touchegg Integration

Three-finger swipes send =Ctrl+Alt+Left/Right= via the existing touchegg
config (=~/.config/touchegg/touchegg.conf=). dwm binds those same key combos
to =shiftview= (previous/next tag), so swipes cycle workspaces just like in
Cinnamon. Uses =SEND_KEYS= action instead of =CHANGE_DESKTOP= as a workaround
for touchegg instability.

* Screen Locking

Uses =xss-lock= with =--transfer-sleep-lock= protocol and =i3lock=:

1. =xss-lock -l= obtains a systemd delay inhibitor before sleep
2. systemd-logind waits for the inhibitor to release
3. =xss-lock= launches =dwm-lock=, passing the inhibitor file descriptor
4. =dwm-lock= starts =i3lock=, waits for it to render, then closes the FD
5. Only then does systemd proceed to suspend
6. On wake, =i3lock= is still running — password required

Idle timeouts are managed by =dwm-idle= (via =xprintidle=):

- *10 minutes*: lock session (=loginctl lock-session= → triggers =xss-lock=)
- *25 minutes*: suspend (=systemctl suspend=)
- Fullscreen windows inhibit both lock and suspend

* Compositor (picom)

Picom runs as a compositor providing:

- *Transparency* (83% opacity) on st and Emacs windows
- *Background blur* (dual_kawase, strength 7) on the same windows
- *Rounded corners* (22px radius) on all windows except the bar
- *Inactive dimming* (35%) to visually indicate focused window
- GLX backend with vsync, fading enabled

Config: =~/.config/picom/picom.conf=

* Patches Applied

dwm and st are built from vanilla tarballs with these patches applied by =dwm-build=:

- *dwm-gaps* (=dwm-gaps-patch.py=): uselessgap-style gaps around all windows and in monocle mode
- *dwm-status2d* (=dwm-status2d-patch.py=): colored status bar segments
- *st-scrollback* (=st-scrollback.diff=): scrollback buffer for st
- *st-scrollback-mouse* (=st-scrollback-mouse.diff=): Shift+scroll wheel to scroll st
- *st-anysize* (=st-anysize-patch.py=): center content in st when window doesn't fit cell grid exactly

* Build / Install

#+begin_src bash
# Install dependencies
sudo apt install xss-lock i3lock brightnessctl rofi xsettingsd picom \
    libx11-dev libxft-dev libxinerama-dev libharfbuzz-dev \
    x11-xserver-utils feh touchegg dbus-x11

# Stow the configs
cd ~/dotfiles && stow dwm touchegg

# Build dwm + st and install to ~/.local/bin/
dwm-build

# Log out and select "Default Xsession" from LightDM
#+end_src

* Modifying Key Bindings

1. Edit =~/.config/dwm/dwm-config.h=
2. Run =dwm-build= to recompile
3. Restart dwm (Super+Shift+BackSpace then log back in)

* Files

| File                 | Purpose                                    |
|----------------------+--------------------------------------------|
| =dwm-config.h=      | dwm config.h (keybindings, appearance)     |
| =st-config.h=       | st config.h (font, colors)                 |
| =dwm-start=         | Session startup (env, daemons, exec)        |
| =dwm-lock=          | xss-lock + i3lock wrapper                  |
| =dwm-status=        | Status bar loop                            |
| =dwm-build=         | Download + compile + install               |
| =dwm-idle=          | Idle lock & suspend with fullscreen inhibit |
| =xresources=        | Xft.dpi and font rendering                 |
| =xsettingsd.conf=   | GTK scaling and theme via XSETTINGS        |
| =picom.conf=        | Compositor (transparency, blur)            |
| =rofi/config.rasi=  | App launcher config                        |
| =gtk-3.0/settings.ini= | GTK 3 theme settings                    |
| =gtk-4.0/settings.ini= | GTK 4 theme settings                    |
| =touchegg.conf=     | Three-finger swipe gestures                |
