#!/bin/bash
# dwm-idle â€” idle lock & suspend with fullscreen inhibition

LOCK_MIN=10       # minutes
SUSPEND_MIN=25    # minutes
POLL=30           # seconds

is_fullscreen() {
    local wid
    wid=$(xprop -root _NET_ACTIVE_WINDOW | grep -oP '0x\w+' | tail -1) || return 1
    [[ -n "$wid" ]] && xprop -id "$wid" _NET_WM_STATE 2>/dev/null | grep -q _NET_WM_STATE_FULLSCREEN
}

locked=false

while sleep "$POLL"; do
    idle_ms=$(xprintidle 2>/dev/null) || continue
    idle_min=$(( idle_ms / 60000 ))

    if is_fullscreen; then
        locked=false
        continue
    fi

    if (( idle_min >= SUSPEND_MIN )); then
        systemctl suspend
        locked=false
    elif (( idle_min >= LOCK_MIN )) && ! "$locked"; then
        loginctl lock-session
        locked=true
    elif (( idle_min < LOCK_MIN )); then
        locked=false
    fi
done
