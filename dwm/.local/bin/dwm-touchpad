#!/bin/bash
# dwm-touchpad â€” Apply libinput settings on start, after resume,
#                and when input devices are added (power management re-enumeration)

apply() {
    for id in $(xinput list --id-only 2>/dev/null); do
        xinput set-prop "$id" "libinput Natural Scrolling Enabled" 1 2>/dev/null || true
        xinput set-prop "$id" "libinput Tapping Enabled" 0 2>/dev/null || true
        xinput set-prop "$id" "libinput Click Method Enabled" 0 1 2>/dev/null || true
    done
}

apply

# Watch for device additions (covers power-management re-enumeration)
udevadm monitor --subsystem-match=input --udev |
while read -r line; do
    if [[ "$line" == *" add "* ]]; then
        sleep 0.5
        apply
    fi
done &

# Watch for system resume
dbus-monitor --system "type='signal',interface='org.freedesktop.login1.Manager',member=PrepareForSleep" |
while read -r line; do
    if [[ "$line" == *"boolean false"* ]]; then
        sleep 1
        apply
    fi
done &

wait
