#!/bin/bash
# dwm-start — Session entry point for dwm (launched by LightDM)

# HiDPI environment (3120x2080 @ 2x)
# GTK scaling is handled by xsettingsd (Gdk/WindowScalingFactor, Gdk/UnscaledDPI)
export QT_AUTO_SCREEN_SCALE_FACTOR=1
export XCURSOR_SIZE=48

# Load Xresources (Xft.dpi: 192)
xrdb -merge ~/.config/dwm/xresources

# GTK/xsettings daemon
xsettingsd -c ~/.config/dwm/xsettingsd.conf &

# Compositor
picom --config ~/.config/picom/picom.conf &

# Touchegg (3-finger swipe → Ctrl+Alt+Left/Right → tag switch)
touchegg &

# Disable tap-to-click (slick-greeter force-enables it on login)
xinput set-prop "GXTP7863:00 27C6:01E0 Touchpad" "libinput Tapping Enabled" 0

# Screen locker — race-condition-free via sleep lock transfer
xss-lock -l -- ~/.local/bin/dwm-lock &

# Idle lock (10 min) & suspend (25 min) with fullscreen inhibition
~/.local/bin/dwm-idle &

# Dark theme: xsettingsd handles GTK3, gsettings + ADW_DISABLE_PORTAL handles GTK4/libadwaita
export ADW_DISABLE_PORTAL=1
gsettings set org.gnome.desktop.interface color-scheme prefer-dark 2>/dev/null || true
gsettings set org.gnome.desktop.interface gtk-theme Mint-Y-Dark-Blue 2>/dev/null || true

# Wallpaper (same as Cinnamon)
feh --bg-fill /usr/share/backgrounds/linuxmint-wilma/aksenapati_blanket.jpg &

# Status bar
~/.local/bin/dwm-status &

exec ~/.local/bin/dwm
